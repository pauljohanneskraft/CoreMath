matrix:
  fast-finish: true
  include:
    - os: osx
      language: swift
      osx_image: xcode8
    - os: linux
      sudo: required
      dist: trusty
  allow_failures:
   - os: linux

notifications:
  slack: pauljohanneskraft:uXzmppJPaAEt8adnz6AbsHSf

before_install:
- if [[ $TRAVIS_OS_NAME == linux ]]; then 
      wget -q -O - https://swift.org/keys/all-keys.asc | gpg --import - && 
      export SWIFT_VERSION=swift-3.0-GM-CANDIDATE && 
      wget https://swift.org/builds/${SWIFT_VERSION}/ubuntu1404/${SWIFT_VERSION}/${SWIFT_VERSION}-ubuntu14.04.tar.gz && 
      tar xzf ${SWIFT_VERSION}-ubuntu14.04.tar.gz && 
      export PATH=${PWD}/${SWIFT_VERSION}-ubuntu14.04/usr/bin:"${PATH}" && 
      export PACKAGE_MANAGER_VERSION=swift-DEVELOPMENT-SNAPSHOT-2016-09-07-a && 
      wget https://github.com/apple/swift-package-manager/archive/${PACKAGE_MANAGER_VERSION}.tar.gz && 
      tar xzf ${PACKAGE_MANAGER_VERSION}.tar.gz && 
      export PATH=${PWD}/${PACKAGE_MANAGER_VERSION}/usr/bin:"${PATH}";
  fi
  
- if [[ $TRAVIS_OS_NAME == osx   ]]; then 
      gem install xcpretty-travis-formatter; 
  fi

install:
- if [[ $TRAVIS_OS_NAME == linux ]]; then 
      mkdir .sources && 
      find Sources -name '*.swift' -exec mv {} .sources \; &&
      rm -rf Sources &&
      mkdir Sources &&
      mv .sources/*.swift Sources &&
      rm -rf .sources &&
      mkdir .tests &&
      mv *Tests .tests &&
      mv .tests Tests;
  fi
script:
- if [[ $TRAVIS_OS_NAME == linux ]]; then 
      swift package --version &&
      swift build &&
      swift test;
  fi
  
- if [[ $TRAVIS_OS_NAME == osx   ]]; then 
      xcodebuild -workspace Math.xcworkspace -scheme MathTests test | xcpretty -f `xcpretty-travis-formatter` && 
      export status=${PIPESTATUS[0]} &&
      bash <(curl -s https://codecov.io/bash) && 
      exit ${status}; 
  fi
