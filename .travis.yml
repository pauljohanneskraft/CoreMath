matrix:
  fast-finish: true
  include:
    - os: osx
      language: swift
      osx_image: xcode8
    - os: linux
      sudo: required
      dist: trusty

notifications:
  slack: pauljohanneskraft:uXzmppJPaAEt8adnz6AbsHSf

before_install:
- if [[ $TRAVIS_OS_NAME == linux ]]; then 
      wget -q -O - https://swift.org/keys/all-keys.asc | gpg --import - && 
      export SWIFT_VERSION_UPPER=swift-3.0.2-RELEASE && 
      export SWIFT_VERSION_LOWER=swift-3.0.2-release &&
      wget https://swift.org/builds/${SWIFT_VERSION_LOWER}/ubuntu1404/${SWIFT_VERSION_UPPER}/${SWIFT_VERSION_UPPER}-ubuntu14.04.tar.gz && 
      tar xzf ${SWIFT_VERSION_UPPER}-ubuntu14.04.tar.gz && 
      export PATH=${PWD}/${SWIFT_VERSION_UPPER}-ubuntu14.04/usr/bin:"${PATH}" &&
      export PACKAGE_MANAGER_VERSION=swift-DEVELOPMENT-SNAPSHOT-2017-01-20-a && 
      wget https://github.com/apple/swift-package-manager/archive/${PACKAGE_MANAGER_VERSION}.tar.gz && 
      tar xzf ${PACKAGE_MANAGER_VERSION}.tar.gz && 
      export PATH=${PWD}/${PACKAGE_MANAGER_VERSION}/usr/bin:"${PATH}";
  fi
  
- if [[ $TRAVIS_OS_NAME == osx   ]]; then 
      gem install xcpretty-travis-formatter; 
  fi

install:
- if [[ $TRAVIS_OS_NAME == linux ]]; then 
      sh linux.sh;
  fi

script:
- if [[ $TRAVIS_OS_NAME == linux ]]; then 
      swift test && 
      echo "Tests passed.";
  fi
  
- if [[ $TRAVIS_OS_NAME == osx   ]]; then 
      xcodebuild -workspace Math.xcworkspace -scheme MathTests test | xcpretty -f `xcpretty-travis-formatter` && 
      export status=${PIPESTATUS[0]} &&
      bash <(curl -s https://codecov.io/bash) && 
      exit ${status}; 
  fi
